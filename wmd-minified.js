edContext="";var Attacklab=Attacklab||{};Attacklab.wmdBase=function(b){var n=b;var r=top.document;var j=top.RegExp;var g=top.navigator;n.Util={};n.Position={};n.Command={};n.Global={};var a=n.Util;var q=n.Position;var e=n.Command;var k=n.Global;k.isIE=/msie/.test(g.userAgent.toLowerCase());k.isIE_5or6=/msie 6/.test(g.userAgent.toLowerCase())||/msie 5/.test(g.userAgent.toLowerCase());k.isIE_7plus=k.isIE&&!k.isIE_5or6;k.isOpera=/opera/.test(g.userAgent.toLowerCase());k.isKonqueror=/konqueror/.test(g.userAgent.toLowerCase());k.isFirefox=/firefox/.test(g.userAgent.toLowerCase());k.insertChar="";k.fileCons="";k.isImage=false;k.killHandle;k.gbloadwin;k.edContext="";var p="<p style='margin-top: 0px'><b>Faciliteu URL imatge extern.</b></p><p>Es pot afegir un títol. El títol es mostrará com pop-up.</p><p>Mostra:<br />http://wmd-editor.com/images/cloud1.jpg   \"Títol opcional\"</p>";var s="<p style='margin-top: 0px'><b>Faciliteu la direcció de un web extern.</b></p><p>Es pot afegir un títol. El títol es mostrará com pop-up.</p><p>Mostra:<br />http://wmd-editor.com/   \"Títol opcional\"</p>";var c="http://";var d="http://";var h="images/";var o=500;var m=100;var f="http://wmd-editor.com/";var i="WMD website";var l="_blank";n.PanelCollection=function(){this.buttonBar=jQuery("#wmd-button-bar");this.preview=jQuery("#wmd-preview");this.output=jQuery("#wmd-output");this.input=r.getElementById("wmd-input")};n.panels=undefined;n.ieCachedRange=null;n.ieRetardedClick=false;a.isVisible=function(t){while(t&&t.parentNode){if(t.style.display=="none"||t.style.visibility=="hidden"){return false}t=t.parentNode}return true};a.addEvent=function(u,t,v){if(u.attachEvent){u.attachEvent("on"+t,v)}else{u.addEventListener(t,v,false)}};a.removeEvent=function(u,t,v){if(u.detachEvent){u.detachEvent("on"+t,v)}else{u.removeEventListener(t,v,false)}};a.fixEolChars=function(t){t=t.replace(/\r\n/g,"\n");t=t.replace(/\r/g,"\n");return t};a.extendRegExp=function(w,y,v){if(y===null||y===undefined){y=""}if(v===null||v===undefined){v=""}var x=w.toString();var u="";var t=x.match(/\/([gim]*)$/);if(t===null){u=t[0]}else{u=""}x=x.replace(/(^\/|\/[gim]*$)/g,"");x=y+x+v;return new RegExp(x,u)};a.createImage=function(t){var v=h+t;var u=r.createElement("img");u.className="wmd-button";u.src=v;return u};a.extern=function(t){k.insertChar="";var u=function(){if(k.insertChar!=""){t(k.insertChar)}};edContext=k.edContext;return false};a.filemanager=function(u){k.fileCons="";k.isImage=false;var t=function(){if(k.fileCons!=""){u(k.fileCons,k.isImage)}};edContext=k.edContext};a.prompt=function(z,C,v){var w;var t;var x;if(C===undefined){C=""}var y=function(D){var E=(D.charCode||D.keyCode);if(E===27){A(true)}};var A=function(D){a.removeEvent(r.body,"keydown",y);var E=x.value;if(D){E=null}else{E=E.replace("http://http://","http://");E=E.replace("http://https://","https://");E=E.replace("http://ftp://","ftp://");if(E.indexOf("http://")===-1&&E.indexOf("ftp://")===-1&&E.indexOf("https://")===-1){E="http://"+E}}w.parentNode.removeChild(w);t.parentNode.removeChild(t);v(E);return false};var u=function(){t=r.createElement("div");t.className="wmd-prompt-background";style=t.style;style.position="absolute";style.top="0";style.zIndex="1000";if(k.isKonqueror){style.backgroundColor="transparent"}else{if(k.isIE){style.filter="alpha(opacity=50)"}else{style.opacity="0.5"}}var D=q.getPageSize();style.height=D[1]+"px";if(k.isIE){style.left=r.documentElement.scrollLeft;style.width=r.documentElement.clientWidth}else{style.left="0";style.width="100%"}r.body.appendChild(t)};var B=function(){w=r.createElement("div");w.className="wmd-prompt-dialog";w.style.padding="10px;";w.style.position="fixed";w.style.width="400px";w.style.zIndex="1001";var D=r.createElement("div");D.innerHTML=z;D.style.padding="5px";w.appendChild(D);var E=r.createElement("form");E.onsubmit=function(){return A(false)};style=E.style;style.padding="0";style.margin="0";style.cssFloat="left";style.width="100%";style.textAlign="center";style.position="relative";w.appendChild(E);x=r.createElement("input");x.type="text";x.value=C;style=x.style;style.display="block";style.width="80%";style.marginLeft=style.marginRight="auto";E.appendChild(x);var G=r.createElement("input");G.type="button";G.onclick=function(){return A(false)};G.value="OK";style=G.style;style.margin="10px";style.display="inline";style.width="7em";var F=r.createElement("input");F.type="button";F.onclick=function(){return A(true)};F.value="Cancelar";style=F.style;style.margin="10px";style.display="inline";style.width="7em";if(/mac/.test(g.platform.toLowerCase())){E.appendChild(F);E.appendChild(G)}else{E.appendChild(G);E.appendChild(F)}a.addEvent(r.body,"keydown",y);w.style.top="50%";w.style.left="50%";w.style.display="block";if(k.isIE_5or6){w.style.position="absolute";w.style.top=r.documentElement.scrollTop+200+"px";w.style.left="50%"}r.body.appendChild(w);w.style.marginTop=-(q.getHeight(w)/2)+"px";w.style.marginLeft=-(q.getWidth(w)/2)+"px"};u();top.setTimeout(function(){B();var E=C.length;if(x.selectionStart!==undefined){x.selectionStart=0;x.selectionEnd=E}else{if(x.createTextRange){var D=x.createTextRange();D.collapse(false);D.moveStart("character",-E);D.moveEnd("character",E);D.select()}}x.focus()},0)};q.getTop=function(v,u){var t=v.offsetTop;if(!u){while(v=v.offsetParent){t+=v.offsetTop}}return t};q.getHeight=function(t){return t.offsetHeight||t.scrollHeight};q.getWidth=function(t){return t.offsetWidth||t.scrollWidth};q.getPageSize=function(){var u,v;var t,y;if(self.innerHeight&&self.scrollMaxY){u=r.body.scrollWidth;v=self.innerHeight+self.scrollMaxY}else{if(r.body.scrollHeight>r.body.offsetHeight){u=r.body.scrollWidth;v=r.body.scrollHeight}else{u=r.body.offsetWidth;v=r.body.offsetHeight}}if(self.innerHeight){t=self.innerWidth;y=self.innerHeight}else{if(r.documentElement&&r.documentElement.clientHeight){t=r.documentElement.clientWidth;y=r.documentElement.clientHeight}else{if(r.body){t=r.body.clientWidth;y=r.body.clientHeight}}}var x=Math.max(u,t);var w=Math.max(v,y);return[x,w,t,y]};n.inputPoller=function(C,v){var t=this;var x=n.panels.input;var u;var w;var z=0;var y;k.killHandle=null;this.tick=function(){try{if(!a.isVisible(x)||r.getElementById("wikieditor").style.display=="none"){return}var H=x.value;var F=H.match(/\n/g);var E=F.length*20;if(E!=z){x.style.height=E+"px";z=E}if(x.selectionStart||x.selectionStart===0){var I=x.selectionStart;var D=x.selectionEnd;if(I!=u||D!=w){u=I;w=D;if(y!=x.value){y=x.value;return true}}}}catch(G){}return false};var B=function(){if(!a.isVisible(x)){return}if(t.tick()){C()}};var A=function(){k.killHandle=top.setInterval(B,v)};this.destroy=function(){top.clearInterval(k.killHandle)};A()};n.undoManager=function(E){var I=this;var C=[];var A=0;var z="none";var u;var F;var v;var y;var t=function(K,J){if(z!=K){z=K;if(!J){w()}}if(!k.isIE||z!="moving"){v=top.setTimeout(B,1)}else{y=null}};var B=function(){y=new n.TextareaState();F.tick();v=undefined};this.setCommandMode=function(){z="command";w();v=top.setTimeout(B,0)};this.canUndo=function(){return A>1};this.canRedo=function(){if(C[A+1]){return true}return false};this.undo=function(){if(I.canUndo()){if(u){u.restore();u=null}else{C[A]=new n.TextareaState();C[--A].restore();if(E){E()}}}z="none";n.panels.input.focus();B()};this.redo=function(){if(I.canRedo()){C[++A].restore();if(E){E()}}z="none";n.panels.input.focus();B()};var w=function(){try{var J=y||new n.TextareaState();if(!J){return false}if(z=="moving"){if(!u){u=J}return}if(u){if(C[A-1].text!=u.text){C[A++]=u}u=null}C[A++]=J;C[A+1]=null;if(E){E()}}catch(K){}};var D=function(J){var L=false;if(J.ctrlKey||J.metaKey){var K=J.charCode||J.keyCode;var M=String.fromCharCode(K);switch(M){case"y":I.redo();L=true;break;case"z":if(!J.shiftKey){I.undo()}else{I.redo()}L=true;break}}if(L){if(J.preventDefault){J.preventDefault()}if(top.event){top.event.returnValue=false}return}};var H=function(J){if(!J.ctrlKey&&!J.metaKey){var K=J.keyCode;if((K>=33&&K<=40)||(K>=63232&&K<=63235)){t("moving")}else{if(K==8||K==46||K==127){t("deleting")}else{if(K==13){t("newlines")}else{if(K==27){t("escape")}else{if((K<16||K>20)&&K!=91){t("typing")}}}}}}};var x=function(){a.addEvent(n.panels.input,"keypress",function(K){if((K.ctrlKey||K.metaKey)&&(K.keyCode==89||K.keyCode==90)){K.preventDefault()}else{if(K.keyCode==9){K.preventDefault()}}});var J=function(){if(k.isIE||(y&&y.text!=n.panels.input.value)){if(v==undefined){z="paste";w();B()}}};F=new n.inputPoller(J,m);a.addEvent(n.panels.input,"keydown",D);a.addEvent(n.panels.input,"keydown",H);a.addEvent(n.panels.input,"mousedown",function(){t("moving")});n.panels.input.onpaste=J;n.panels.input.ondrop=J};var G=function(){x();B();w()};this.destroy=function(){if(F){F.destroy()}};G()};n.editor=function(D,C){if(!C){C=function(){}}n.panels.input=D;var z=n.panels.input;var w=0;var E=this;var y;var G;var u;var A;var B;var J=function(L){z.focus();if(L.textOp){if(B){B.setCommandMode()}var N=new n.TextareaState();if(!N){return}var P=N.getChunks();var K=function(){z.focus();if(P){N.setChunks(P)}N.restore();C()};var O=true;var M=L.textOp(P,K,O);if(!M){K()}}if(L.execute){L.execute(E)}};var H=function(){if(B){t(jQuery(n.panels.buttonBar).find(".wmd-undo-button")[0],B.canUndo());t(jQuery(n.panels.buttonBar).find(".wmd-redo-button")[0],B.canRedo())}};var t=function(K,M){var N="0px";var O="-20px";var L="-40px";if(M){K.style.backgroundPosition=K.XShift+" "+N;K.onmouseover=function(){this.style.backgroundPosition=this.XShift+" "+L};K.onmouseout=function(){this.style.backgroundPosition=this.XShift+" "+N};if(k.isIE){K.onmousedown=function(){n.ieRetardedClick=true;n.ieCachedRange=document.selection.createRange()}}if(!K.isHelp){K.onclick=function(){if(this.onmouseout){this.onmouseout()}J(this);return false}}}else{K.style.backgroundPosition=K.XShift+" "+O;K.onmouseover=K.onmouseout=K.onclick=function(){}}};var x=function(P){var K="0px";var O="-20px";var V="-40px";var Z=document.createElement("ul");Z.className="wmd-button-row";Z=P.appendChild(Z);var U=document.createElement("li");U.className="wmd-button wmd-bold-button";U.title="Negreta <strong> Ctrl+B";U.XShift="0px";U.textOp=e.doBold;t(U,true);Z.appendChild(U);var S=document.createElement("li");S.className="wmd-button wmd-italic-button";S.title="Emfasis <em> Ctrl+I";S.XShift="-20px";S.textOp=e.doItalic;t(S,true);Z.appendChild(S);var X=document.createElement("li");X.className="wmd-button wmd-link-button";X.title="Enllaç <a> Ctrl+L";X.XShift="-40px";X.textOp=function(ag,ah,ai){return e.doLinkOrImage(ag,ah,false)};t(X,true);Z.appendChild(X);var aa=document.createElement("li");aa.className="wmd-button wmd-quote-button";aa.title="Citació <blockquote> Ctrl+Q";aa.XShift="-60px";aa.textOp=e.doBlockquote;t(aa,true);Z.appendChild(aa);var ab=document.createElement("li");ab.className="wmd-button wmd-code-button";ab.title="Codí font <pre><code> Ctrl+K";ab.XShift="-80px";ab.textOp=e.doCode;t(ab,true);Z.appendChild(ab);var Q=document.createElement("li");Q.className="wmd-button wmd-image-button";Q.title="Imatge <img> Ctrl+G";Q.XShift="-100px";Q.textOp=function(ag,ah,ai){return e.doLinkOrImage(ag,ah,true)};t(Q,true);Z.appendChild(Q);var R=document.createElement("li");R.className="wmd-button wmd-olist-button";R.title="Llista numerada <ol> Ctrl+O";R.XShift="-120px";R.textOp=function(ag,ah,ai){e.doList(ag,ah,true,ai)};t(R,true);Z.appendChild(R);var af=document.createElement("li");af.className="wmd-button wmd-ulist-button";af.title="Llista normal <ul> Ctrl+U";af.XShift="-140px";af.textOp=function(ag,ah,ai){e.doList(ag,ah,false,ai)};t(af,true);Z.appendChild(af);var Y=document.createElement("li");Y.className="wmd-button wmd-heading-button";Y.title="Títol <h1>/<h2> Ctrl+H";Y.XShift="-160px";Y.textOp=e.doHeading;t(Y,true);Z.appendChild(Y);var M=document.createElement("li");M.className="wmd-button wmd-hr-button";M.title="Separació horizontal <hr> Ctrl+R";M.XShift="-180px";M.textOp=e.doHorizontalRule;t(M,true);Z.appendChild(M);var L=document.createElement("li");L.className="wmd-button wmd-undo-button";L.title="Undo - Ctrl+Z";L.XShift="-200px";L.execute=function(ag){ag.undo()};t(L,true);Z.appendChild(L);var ae=document.createElement("li");ae.className="wmd-button wmd-redo-button";ae.title="Redo - Ctrl+Y";if(/win/.test(g.platform.toLowerCase())){ae.title="Redo - Ctrl+Y"}else{ae.title="Redo - Ctrl+Shift+Z"}ae.XShift="-220px";ae.execute=function(ag){ag.redo()};t(ae,true);Z.appendChild(ae);var ad=document.createElement("li");ad.className="wmd-button wmd-schrbtn-button";ad.title="Caracters especials Ctrl+W";ad.XShift="-260px";ad.textOp=function(ag,ah,ai){return e.doSpecChars(ag,ah)};t(ad,true);Z.appendChild(ad);var W=document.createElement("li");W.className="wmd-button wmd-filemanager-button";W.title="Enllaços interns";W.XShift="-280px";W.textOp=function(ag,ah,ai){return e.doFileManager(ag,ah)};t(W,true);Z.appendChild(W);var ac=document.createElement("li");ac.className="wmd-button wmd-help-button";ac.XShift="-240px";ac.isHelp=true;var N=document.createElement("a");N.href=f;N.target=l;N.title=i;ac.appendChild(N);t(ac,true);Z.appendChild(ac);if(top.document.getElementById("btn"+k.edContext+"save")!=null){var T=document.createElement("li");T.className="wmd-button wmd-save-button";T.title="Guardar";T.XShift="-300px";T.textOp=function(ag,ah,ai){top.document.getElementById("btn"+k.edContext+"save").click();return false};t(T,true);Z.appendChild(T)}H()};var v=function(){if(/\?noundo/.test(r.location.href)){n.nativeUndo=true}if(!n.nativeUndo){B=new n.undoManager(function(){C();H()})}jQuery(n.panels.input).before("<div></div>");n.panels.buttonBar=jQuery(n.panels.input).prev("div")[0];jQuery(n.panels.buttonBar).addClass("wmd-button-bar");jQuery(n.panels.input).addClass("wmd-input");x(n.panels.buttonBar);var L="keydown";if(k.isOpera){L="keypress"}a.addEvent(z,L,function(N){if(N.ctrlKey||N.metaKey){var O=N.charCode||N.keyCode;var M=String.fromCharCode(O).toLowerCase();switch(M){case"b":J(jQuery(n.panels.buttonBar).find(".wmd-bold-button")[0]);break;case"i":J(jQuery(n.panels.buttonBar).find(".wmd-italic-button")[0]);break;case"l":J(jQuery(n.panels.buttonBar).find(".wmd-link-button")[0]);break;case"q":J(jQuery(n.panels.buttonBar).find(".wmd-quote-button")[0]);break;case"k":J(jQuery(n.panels.buttonBar).find(".wmd-code-button")[0]);break;case"g":J(jQuery(n.panels.buttonBar).find(".wmd-image-button")[0]);break;case"o":J(jQuery(n.panels.buttonBar).find(".wmd-olist-button")[0]);break;case"u":J(jQuery(n.panels.buttonBar).find(".wmd-ulist-button")[0]);break;case"h":J(jQuery(n.panels.buttonBar).find(".wmd-heading-button")[0]);break;case"r":J(jQuery(n.panels.buttonBar).find(".wmd-hr-button")[0]);break;case"y":J(jQuery(n.panels.buttonBar).find(".wmd-redo-button")[0]);break;case"z":if(N.shiftKey){J(jQuery(n.panels.buttonBar).find(".wmd-redo-button")[0])}else{J(jQuery(n.panels.buttonBar).find(".wmd-undo-button")[0])}break;default:return}if(N.preventDefault){N.preventDefault()}if(top.event){top.event.returnValue=false}}});a.addEvent(z,"keyup",function(M){if(M.shiftKey&&!M.ctrlKey&&!M.metaKey){var N=M.charCode||M.keyCode;if(N===13){fakeButton={};fakeButton.textOp=e.doAutoindent;J(fakeButton)}else{if(N===9){fakeButton={};fakeButton.textOp=e.doUnTab;J(fakeButton)}}}});a.addEvent(z,L,function(M){if(!M.shiftKey&&!M.ctrlKey&&!M.metaKey){var N=M.charCode||M.keyCode;if(N===9){fakeButton={};fakeButton.textOp=e.doTab;J(fakeButton)}}});if(k.isIE){a.addEvent(z,"keydown",function(M){var N=M.keyCode;if(N===27){return false}})}if(z.form){var K=z.form.onsubmit;z.form.onsubmit=function(){F();if(K){return K.apply(this,arguments)}}}};var F=function(){if(n.wmd_env.convertInputBeforeSubmit){if(n.showdown){var K=new n.showdown.converter()}var L=z.value;var M=function(){z.value=L};if(!/markdown/.test(n.wmd_env.output.toLowerCase())){if(K){z.value=K.makeHtml(L);top.setTimeout(M,0)}}}else{}return true};this.undo=function(){if(B){B.undo()}};this.redo=function(){if(B){B.redo()}};var I=function(){v()};this.destroy=function(){if(B){B.destroy()}if(u.parentNode){u.parentNode.removeChild(u)}if(z){z.style.marginTop=""}top.clearInterval(A)};I()};n.TextareaState=function(){var t=this;var u=n.panels.input;this.init=function(){if(!a.isVisible(u)){return}try{this.setInputAreaSelectionStartEnd();this.scrollTop=u.scrollTop;if(!this.text&&u.selectionStart||u.selectionStart===0){this.text=u.value}}catch(v){}};this.setInputAreaSelection=function(){if(!a.isVisible(u)){return}if(u.selectionStart!==undefined&&!k.isOpera){u.focus();u.selectionStart=t.start;u.selectionEnd=t.end;u.scrollTop=t.scrollTop}else{if(r.selection){if(r.activeElement&&r.activeElement!==u){return}u.focus();var v=u.createTextRange();v.moveStart("character",-u.value.length);v.moveEnd("character",-u.value.length);v.moveEnd("character",t.end);v.moveStart("character",t.start);v.select()}}};this.setInputAreaSelectionStartEnd=function(){try{if(u.selectionStart||u.selectionStart===0){t.start=u.selectionStart;t.end=u.selectionEnd}else{if(r.selection){t.text=a.fixEolChars(u.value);var y;if(n.ieRetardedClick&&n.ieCachedRange){y=n.ieCachedRange;n.ieRetardedClick=false}else{y=r.selection.createRange()}var z=a.fixEolChars(y.text);var x="\x07";var w=x+z+x;y.text=w;var B=a.fixEolChars(u.value);y.moveStart("character",-w.length);y.text=z;t.start=B.indexOf(x);t.end=B.lastIndexOf(x)-x.length;var v=t.text.length-a.fixEolChars(u.value).length;if(v){y.moveStart("character",-z.length);while(v--){z+="\n";t.end+=1}y.text=z}this.setInputAreaSelection()}}}catch(A){}};this.restore=function(){if(t.text!=undefined&&t.text!=u.value){u.value=t.text}this.setInputAreaSelection();u.scrollTop=t.scrollTop};this.getChunks=function(){var v=new n.Chunks();v.before=a.fixEolChars(t.text.substring(0,t.start));v.startTag="";v.selection=a.fixEolChars(t.text.substring(t.start,t.end));v.endTag="";v.after=a.fixEolChars(t.text.substring(t.end));v.scrollTop=t.scrollTop;return v};this.setChunks=function(v){v.before=v.before+v.startTag;v.after=v.endTag+v.after;if(k.isOpera){v.before=v.before.replace(/\n/g,"\r\n");v.selection=v.selection.replace(/\n/g,"\r\n");v.after=v.after.replace(/\n/g,"\r\n")}this.start=v.before.length;this.end=v.before.length+v.selection.length;this.text=v.before+v.selection+v.after;this.scrollTop=v.scrollTop};this.init()};n.Chunks=function(){};n.Chunks.prototype.findTags=function(u,w){var t=this;var v;if(u){v=a.extendRegExp(u,"","$");this.before=this.before.replace(v,function(x){t.startTag=t.startTag+x;return""});v=a.extendRegExp(u,"^","");this.selection=this.selection.replace(v,function(x){t.startTag=t.startTag+x;return""})}if(w){v=a.extendRegExp(w,"","$");this.selection=this.selection.replace(v,function(x){t.endTag=x+t.endTag;return""});v=a.extendRegExp(w,"^","");this.after=this.after.replace(v,function(x){t.endTag=x+t.endTag;return""})}};n.Chunks.prototype.trimWhitespace=function(t){this.selection=this.selection.replace(/^(\s*)/,"");if(!t){this.before+=j.$1}this.selection=this.selection.replace(/(\s*)$/,"");if(!t){this.after=j.$1+this.after}};n.Chunks.prototype.addBlankLines=function(w,v,t){if(w===undefined){w=1}if(v===undefined){v=1}w++;v++;var x;var y;var u;this.selection=this.selection.replace(/(^\n*)/,"");this.startTag=this.startTag+(u?u[1]:"");u=/(\n*$)/.exec(this.selection);this.selection=this.selection.replace(/(\n*$)/,"");this.endTag=this.endTag+(u?u[1]:"");u=/(^\n*)/.exec(this.startTag);this.startTag=this.startTag.replace(/(^\n*)/,"");this.before=this.before+(u?u[1]:"");u=/(\n*$)/.exec(this.endTag);this.endTag=this.endTag.replace(/(\n*$)/,"");this.after=this.after+(u?u[1]:"");if(this.before){x=y="";while(w--){x+="\\n?";y+="\n"}if(t){x="\\n*"}this.before=this.before.replace(new j(x+"$",""),y)}if(this.after){x=y="";while(v--){x+="\\n?";y+="\n"}if(t){x="\\n*"}this.after=this.after.replace(new j(x,""),y)}};e.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";e.unwrap=function(u){var t=new j("([^\\n])\\n(?!(\\n|"+e.prefixes+"))","g");u.selection=u.selection.replace(t,"$1 $2")};e.wrap=function(u,t){e.unwrap(u);var v=new j("(.{1,"+t+"})( +|$\\n?)","gm");u.selection=u.selection.replace(v,function(w,x){if(new j("^"+e.prefixes,"").test(w)){return w}return x+"\n"});u.selection=u.selection.replace(/\s+$/,"")};e.doBold=function(t,u,v){return e.doBorI(t,2,"strong text")};e.doItalic=function(t,u,v){return e.doBorI(t,1,"emphasized text")};e.doBorI=function(w,A,z){w.trimWhitespace();w.selection=w.selection.replace(/\n{2,}/g,"\n");w.before.search(/(\**$)/);var y=j.$1;w.after.search(/(^\**)/);var x=j.$1;var t=Math.min(y.length,x.length);if((t>=A)&&(t!=2||A!=1)){w.before=w.before.replace(j("[*]{"+A+"}$",""),"");w.after=w.after.replace(j("^[*]{"+A+"}",""),"")}else{if(!w.selection&&x){w.after=w.after.replace(/^([*_]*)/,"");w.before=w.before.replace(/(\s?)$/,"");var v=j.$1;w.before=w.before+x+v}else{if(!w.selection&&!x){w.selection=z}var u=A<=1?"*":"**";w.before=w.before+u;w.after=u+w.after}}return};e.stripLinkDefs=function(u,t){u=u.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(y,z,v,w,x){t[z]=y.replace(/\s*$/,"");if(w){t[z]=y.replace(/["(](.+?)[")]$/,"");return w+x}return""});return u};e.addLinkDef=function(A,w){var t=0;var v={};A.before=e.stripLinkDefs(A.before,v);A.selection=e.stripLinkDefs(A.selection,v);A.after=e.stripLinkDefs(A.after,v);var u="";var z=/(\[(?:\[[^\]]*\]|[^\[\]])*\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g;var y=function(C){t++;C=C.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+t+"]:");u+="\n"+C};var x=function(D,E,F,C){if(v[F]){y(v[F]);return E+t+C}return D};A.before=A.before.replace(z,x);if(w){y(w)}else{A.selection=A.selection.replace(z,x)}var B=t;A.after=A.after.replace(z,x);if(A.after){A.after=A.after.replace(/\n*$/,"")}if(!A.after){A.selection=A.selection.replace(/\n*$/,"")}A.after+="\n\n"+u;return B};e.doLinkOrImage=function(t,u,w){t.trimWhitespace();t.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);if(t.endTag.length>1){t.startTag=t.startTag.replace(/!?\[/,"");t.endTag="";e.addLinkDef(t,null)}else{if(/\n\n/.test(t.selection)){e.addLinkDef(t,null);return}var v=function(z){if(z!==null&&z!=="http://"&&z!=="https://"&&z!=="ftp://"&&z!=="mailto:"){t.startTag=t.endTag="";var y=" [999]: "+z;var x=e.addLinkDef(t,y);t.startTag=w?"![":"[";t.endTag="]["+x+"]";if(!t.selection){if(w){t.selection="text alternatiu"}else{t.selection="text enllaç"}}}else{if(z!==null){alert("Falta un enllaç vàlid")}}u()};if(w){a.prompt(p,c,v)}else{a.prompt(s,d,v)}return true}};e.doFileManager=function(t,u){t.trimWhitespace();t.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);if(t.endTag.length>1){t.startTag=t.startTag.replace(/!?\[/,"");t.endTag="";e.addLinkDef(t,null)}else{if(/\n\n/.test(t.selection)){e.addLinkDef(t,null);return}var v=function(y,z){if(y!==null){t.startTag=t.endTag="";var x=" [999]: "+y;var w=e.addLinkDef(t,x);t.startTag=z?"![":"[";t.endTag="]["+w+"]";if(!t.selection){if(z){t.selection="text alternatiu"}else{t.selection="text enllaç"}}}u()};t.findTags(/\n(.*?)<([^>]*)/,/([^<]*)>(.*?)\n$/);if((t.startTag===t.endTag&&t.endTag=="")){a.filemanager(v);return true}else{alert("Possible conflicte per estar adins de tags html...");return false}}};e.doSpecChars=function(t,v){var u=function(w){if(w!==null){t.selection=w;v()}};t.trimWhitespace();t.findTags(/\n(.*?)<([^>]*)/,/([^<]*)>(.*?)\n$/);if((t.startTag===t.endTag&&t.endTag=="")){a.extern(u);return true}else{alert("Possible conflicte per estar adins de tags html...");return false}};a.makeAPI=function(){n.wmd={};n.wmd.editor=n.editor;n.wmd.previewManager=n.previewManager};a.startEditor=function(){a.makeAPI()};n.previewManager=function(L){n.panels=L;var v=this;var J;var u;var B;var A;var G;var C;var w=3000;var D="delayed";var y=function(M,N){a.addEvent(M,"input",N);M.onpaste=N;M.ondrop=N;a.addEvent(M,"keypress",N);a.addEvent(M,"keydown",N);u=new n.inputPoller(N,o)};var F=function(){var M=0;if(top.innerHeight){M=top.pageYOffset}else{if(r.documentElement&&r.documentElement.scrollTop){M=r.documentElement.scrollTop}else{if(r.body){M=r.body.scrollTop}}}return M};var z=function(){if(!n.panels.preview&&!n.panels.output){return}var O=n.panels.input.value;if(O&&O==G){return}else{G=O}var N=new Date().getTime();if(!J&&n.showdown){J=new n.showdown.converter()}if(J){O=J.makeHtml(O)}var M=new Date().getTime();A=M-N;t(O);C=O};var I=function(){if(B){top.clearTimeout(B);B=undefined}if(D!=="manual"){var M=0;if(D==="delayed"){M=A}if(M>w){M=w}B=top.setTimeout(z,M)}};var x=function(M){if(M.scrollHeight<=M.clientHeight){return 1}return M.scrollTop/(M.scrollHeight-M.clientHeight)};var K=function(){if(n.panels.preview){n.panels.preview.scrollTop=(n.panels.preview.scrollHeight-n.panels.preview.clientHeight)*x(n.panels.preview)}if(n.panels.output){n.panels.output.scrollTop=(n.panels.output.scrollHeight-n.panels.output.clientHeight)*x(n.panels.output)}};this.refresh=function(M){if(M){G="";z()}else{I()}};this.processingTime=function(){return A};this.output=function(){return C};this.setUpdateMode=function(M){D=M;v.refresh()};var E=true;var t=function(P){var M=q.getTop(n.panels.input)-F();if(n.panels.output){if(n.panels.output.value!==undefined){n.panels.output.value=P;n.panels.output.readOnly=true}else{var O=P.replace(/&/g,"&amp;");O=O.replace(/</g,"&lt;");n.panels.output.innerHTML="<pre><code>"+O+"</code></pre>"}}if(n.panels.preview){n.panels.preview.innerHTML=P}K();if(E){E=false;return}var N=q.getTop(n.panels.input)-F();if(k.isIE){top.setTimeout(function(){top.scrollBy(0,N-M)},0)}else{top.scrollBy(0,N-M)}};var H=function(){y(n.panels.input,I);z();if(n.panels.preview){n.panels.preview.scrollTop=0}if(n.panels.output){n.panels.output.scrollTop=0}};this.destroy=function(){if(u){u.destroy()}};H()};e.doAutoindent=function(t,u,v){t.before=t.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");t.before=t.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");t.before=t.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");v=false;if(/(\n|^)[ ]{0,3}([*+-])[ \t]+.*\n$/.test(t.before)){if(e.doList){e.doList(t,u,false,true)}}if(/(\n|^)[ ]{0,3}(\d+[.])[ \t]+.*\n$/.test(t.before)){if(e.doList){e.doList(t,u,true,true)}}if(/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(t.before)){if(e.doBlockquote){e.doBlockquote(t,u,v)}}if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(t.before)){if(e.doCode){e.doCode(t,u,v)}}};e.doTab=function(t,u,v){if(!t.selection&&t.before.search(/(\n|^|\n[ ]{4,})/)==0){t.before+="    "}else{if(t.selection){if(t.before.search(/(\n|^|\n[ ]{4,})/)==0){t.before+="    "}t.selection=t.selection.replace(/\n/g,"\n    ");t.selection=t.selection.replace(/\n[ ]{4,}$/g,"\n")}}};e.doUnTab=function(t,u,v){if(!t.selection){t.before=t.before.replace(/[ ]{4}$/,"")}else{if(t.selection){t.before=t.before.replace(/[ ]{4}$/,"");t.selection=t.selection.replace(/\n[ ]{4}/g,"\n")}}};e.doBlockquote=function(u,v,x){u.selection=u.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(B,A,z,y){u.before+=A;u.after=y+u.after;return z});u.before=u.before.replace(/(>[ \t]*)$/,function(z,y){u.selection=y+u.selection;return""});var t=x?"Citació":"";u.selection=u.selection.replace(/^(\s|>)+$/,"");u.selection=u.selection||t;if(u.before){u.before=u.before.replace(/\n?$/,"\n")}if(u.after){u.after=u.after.replace(/^\n?/,"\n")}u.before=u.before.replace(/(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*$)/,function(y){u.startTag=y;return""});u.after=u.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(y){u.endTag=y;return""});var w=function(z){var y=z?"> ":"";if(u.startTag){u.startTag=u.startTag.replace(/\n((>|\s)*)\n$/,function(B,A){return"\n"+A.replace(/^[ ]{0,3}>?[ \t]*$/gm,y)+"\n"})}if(u.endTag){u.endTag=u.endTag.replace(/^\n((>|\s)*)\n/,function(B,A){return"\n"+A.replace(/^[ ]{0,3}>?[ \t]*$/gm,y)+"\n"})}};if(/^(?![ ]{0,3}>)/m.test(u.selection)){e.wrap(u,n.wmd_env.lineLength-2);u.selection=u.selection.replace(/^/gm,"> ");w(true);u.addBlankLines()}else{u.selection=u.selection.replace(/^[ ]{0,3}> ?/gm,"");e.unwrap(u);w(false);if(!/^(\n|^)[ ]{0,3}>/.test(u.selection)&&u.startTag){u.startTag=u.startTag.replace(/\n{0,2}$/,"\n\n")}if(!/(\n|^)[ ]{0,3}>.*$/.test(u.selection)&&u.endTag){u.endTag=u.endTag.replace(/^\n{0,2}/,"\n\n")}}if(!/\n/.test(u.selection)){u.selection=u.selection.replace(/^(> *)/,function(y,z){u.startTag+=z;return""})}};e.doCode=function(t,u,y){var x=/\S[ ]*$/.test(t.before);var z=/^[ ]*\S/.test(t.after);if((!z&&!x)||/\n/.test(t.selection)){t.before=t.before.replace(/[ ]{4}$/,function(A){t.selection=A+t.selection;return""});var w=1;var v=1;if(/\n(\t|[ ]{4,}).*\n$/.test(t.before)||t.after===""){w=0}if(/^\n(\t|[ ]{4,})/.test(t.after)){v=0}t.addBlankLines(w,v);if(!t.selection){t.startTag="    ";t.selection=y?"Codí font":""}else{if(/^[ ]{0,3}\S/m.test(t.selection)){t.selection=t.selection.replace(/^/gm,"    ")}else{t.selection=t.selection.replace(/^[ ]{4}/gm,"")}}}else{t.trimWhitespace();t.findTags(/`/,/`/);if(!t.startTag&&!t.endTag){t.startTag=t.endTag="`";if(!t.selection){t.selection=y?"Codí font":""}}else{if(t.endTag&&!t.startTag){t.before+=t.endTag;t.endTag=""}else{t.startTag=t.endTag=""}}}};e.doList=function(E,x,w,G){var H=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/;var F=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var t="-";var B=1;var z=function(){var I;if(w){I=" "+B+". ";B++}else{I=" "+t+" "}return I};var A=function(I){if(w===undefined){w=/^\s*\d/.test(I)}I=I.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(J){return z()});return I};E.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);if(E.before&&!/\n$/.test(E.before)&&!/^\n/.test(E.startTag)){E.before+=E.startTag;E.startTag=""}if(E.startTag){var v=/\d+[.]/.test(E.startTag);E.startTag="";E.selection=E.selection.replace(/\n[ ]{4}/g,"\n");e.unwrap(E);E.addBlankLines();if(v){E.after=E.after.replace(F,A)}if(w==v){return}}var y=1;E.before=E.before.replace(H,function(I){if(/^\s*([*+-])/.test(I)){t=j.$1}y=/[^\n]\n\n[^\n]/.test(I)?1:0;return A(I)});if(!E.selection){E.selection=G?"Entrada":" "}var C=z();var u=1;E.after=E.after.replace(F,function(I){u=/[^\n]\n\n[^\n]/.test(I)?1:0;return A(I)});E.trimWhitespace(true);E.addBlankLines(y,u,true);E.startTag=C;var D=C.replace(/./g," ");e.wrap(E,n.wmd_env.lineLength-D.length);E.selection=E.selection.replace(/\n/g,"\n"+D)};e.doHeading=function(z,t,B){var A=z.selection;z.selection=z.selection.replace(/\s+/g," ");z.selection=z.selection.replace(/(^\s+|\s+$)/g,"");var y=z.selection.substring(0,1);if(!z.selection){z.findTags(/[^\n]/,/[^\n]/);if(/[^\n]/.test(z.startTag)){z.startTag+="\n\n## "}else{z.startTag="## "}z.selection="Heading";if(/[^\n]/.test(z.startTag)){z.endTag=" ##\n\n"+z.endTag}else{z.endTag=" ##"}return}var C=0;z.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(z.startTag)){C=j.lastMatch.length}z.startTag=z.endTag="";var u="";if(C==0){z.findTags(/[^\n]/,null);if(/[^\n]/.test(z.startTag)){u=z.startTag.substring(0,1)}z.startTag=z.endTag=""}var v=false;if(C<6){C++}else{if(C==6){C=0;v=true}}var x="#";var w=C;if(C>0){if(C==1&&u!=""){z.startTag=u.replace(/\s+/g,"")+"\n\n"}z.endTag=" ";while(w--){z.endTag+=x;z.startTag+=x}z.startTag+=" ";if(C==1){z.endTag+="\n\n";z.selection=y+z.selection}}else{z.findTags(/[\n]+/,/[\n]+/);if(/[\n]+/.test(z.startTag)){z.startTag=""}if(/[\n]+/.test(z.endTag)){z.endTag=""}z.selection=A;z.findTags(/[^\n]/,/[^\n]/);if(/[^\n]/.test(z.startTag)){z.startTag=z.startTag.substring(0,1)+" ";z.startTag=z.startTag.replace(/\s+/g," ")}if(/[^\n]/.test(z.endTag)){z.endTag=" "+z.endTag.substring(0,1);z.endTag=z.endTag.replace(/\s+/g," ")}z.selection=A}};e.doHorizontalRule=function(t,u,v){t.startTag="----------\n";t.selection="";t.addBlankLines(2,1,true)}};Attacklab.wmd_env={};Attacklab.account_options={};Attacklab.wmd_defaults={version:1,output:"HTML",lineLength:40,delayLoad:false,convertInputBeforeSubmit:false};var newAttacklab=function(){myAttack={};myAttack.showdown=Attacklab.showdown;myAttack.wmd=function(a){a.wmd_env={};a.loadEnv=function(){var c=function(e){if(!e){return}for(var d in e){a.wmd_env[d]=e[d]}};c(Attacklab.wmd_defaults);c(Attacklab.account_options);c(top.wmd_options);a.full=true;var b="bold italic link blockquote code image ol ul heading hr";a.wmd_env.buttons=Attacklab.wmd_env.buttons||b};a.loadEnv()};myAttack.wmd(myAttack);Attacklab.wmdBase(myAttack);myAttack.Util.startEditor();return myAttack};function createWmd(b,g,f){if(!Attacklab){alert("WMD està carregant...!");return null}if(!jQuery){alert("Aquesta versió de WMD necesita jQuery.");return null}var h=$(b)[0];var e={input:h,preview:$(g)[0]};var c=newAttacklab();c.Global.edContext=f;var a=new c.wmd.previewManager(e);var d=new c.wmd.editor(h,a.refresh);return c};
